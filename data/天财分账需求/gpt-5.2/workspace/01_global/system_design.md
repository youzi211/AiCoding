## 2.1 系统结构
系统采用分层架构与领域驱动设计相结合的模式，以“三代”作为业务指令的统一入口和协调层，以“行业钱包”作为核心业务逻辑层，以“清结算”和“账户系统”作为资金处理与账户操作层，以“账务核心”作为最终的账务记录层。各系统角色通过清晰的接口契约进行交互，确保业务、资金、账务的解耦与职责分离。

```mermaid
graph TB
    subgraph "接入层"
        A[天财平台]
        B[钱包APP/商服平台]
    end

    subgraph "业务协调层"
        C[三代]
    end

    subgraph "核心业务层"
        D[行业钱包]
    end

    subgraph "资金处理层"
        E[清结算]
        F[账户系统]
    end

    subgraph "基础服务层"
        G[账务核心]
        H[电子签约平台]
        I[认证系统]
        J[计费中台]
        K[用户中心]
        L[代付系统]
    end

    subgraph "数据与支撑层"
        M[业务核心]
        N[对账单系统]
        O[风控]
        P[交易系统]
    end

    A -->|发起业务指令| C
    B -->|用户操作请求| C
    C -->|协调业务执行| D
    D -->|处理资金请求| E
    E -->|执行账户操作| F
    F -->|记录账务| G
    D -->|发起签约/认证| H
    H -->|调用核验| I
    E & D -->|计算手续费| J
    D & C -->|获取用户ID| K
    D -->|发起提现| L
    C & D & E -->|同步业务数据| M
    M & E & F -->|生成对账单| N
    O -->|发起冻结| E & F
    P -->|触发清分| E
```

## 2.2 功能结构
系统功能围绕“账户管理”、“关系绑定”、“资金操作”、“对账与风控”四大核心领域展开。每个领域由相应的模块提供服务，共同支撑分账、归集、会员结算、批量付款等核心业务场景。

```mermaid
graph TD
    A[天财分账系统]

    B1[账户管理]
    B2[关系绑定]
    B3[资金操作]
    B4[对账与风控]

    A --> B1
    A --> B2
    A --> B3
    A --> B4

    B1 --> C1[开户申请]
    B1 --> C2[账户查询]
    B1 --> C3[账户冻结/解冻]

    B2 --> C4[关系绑定申请]
    B2 --> C5[电子协议签署]
    B2 --> C6[身份认证]

    B3 --> C7[分账/转账]
    B3 --> C8[资金归集]
    B3 --> C9[会员结算]
    B3 --> C10[批量付款]
    B3 --> C11[实时提现]
    B3 --> C12[退货处理]

    B4 --> C13[对账单生成]
    B4 --> C14[数据核对]
    B4 --> C15[风险监控]
    B4 --> C16[冻结指令执行]
```

## 2.3 网络拓扑图
TBD

## 2.4 数据流转
数据流转以“业务指令”和“资金流”为主线。业务指令由天财或前端发起，经三代协调，在行业钱包进行业务逻辑处理，最终由清结算驱动账户系统完成资金变动，并由账务核心记录。关键业务数据同步至业务核心，用于对账和查询。

```mermaid
flowchart LR
    subgraph S1 [指令发起]
        direction LR
        A1[天财平台]
        A2[钱包APP]
    end

    subgraph S2 [业务处理]
        direction TB
        B[三代]
        C[行业钱包]
        D[清结算]
    end

    subgraph S3 [资金与账务]
        direction LR
        E[账户系统]
        F[账务核心]
    end

    subgraph S4 [支撑服务]
        direction LR
        G[业务核心]
        H[对账单系统]
    end

    A1 & A2 -->|1. 发起请求| B
    B -->|2. 指令校验与转发| C
    C -->|3. 业务逻辑处理| D
    D -->|4. 调用资金操作| E
    E -->|5. 驱动记账| F
    C & D -->|6. 同步结果数据| G
    G & E & D -->|7. 提供账单数据| H
```

## 2.5 系统模块交互关系
模块间主要通过同步API调用和异步事件进行交互。三代作为总协调者，依赖多个下游系统完成业务；行业钱包是核心业务枢纽；清结算和账户系统构成资金处理链路；电子签约、认证、计费等作为能力中台被上层业务调用。

```mermaid
flowchart TD
    A[三代]
    B[行业钱包]
    C[清结算]
    D[账户系统]
    E[账务核心]
    F[电子签约平台]
    G[认证系统]
    H[计费中台]
    I[业务核心]
    J[对账单系统]
    K[风控]
    L[用户中心]
    M[代付系统]
    N[交易系统]

    A -->|1. 调用开户/绑定| B
    A -->|2. 同步结算配置| C
    A -->|3. 查询计费规则| H
    A -->|4. 同步业务数据| I
    B -->|5. 获取用户ID| L
    B -->|6. 调用账户操作| D
    B -->|7. 发起签约| F
    B -->|8. 发起分账请求| C
    B -->|9. 发起提现| M
    B -->|10. 同步业务数据| I
    C -->|11. 调用资金扣增| D
    C -->|12. 请求计费| H
    C -->|13. 驱动记账| E
    C -->|14. 执行冻结| K
    C -->|15. 提供账单数据| J
    D -->|16. 驱动记账| E
    F -->|17. 调用身份认证| G
    M -->|18. 调用账户扣减| D
    N -->|19. 触发清分| C
    K -->|20. 发起冻结指令| C & D
    J -->|21. 拉取数据| I & C & D
```