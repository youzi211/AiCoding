# 4. 接口设计

## 4.1 对外接口

本系统对外暴露的接口主要服务于“天财商龙”业务、商户及运营管理，是外部系统与分账平台交互的入口。所有接口均需遵循统一的认证、鉴权、限流及数据安全规范。

### 4.1.1 商户与业务管理接口

此类接口主要由三代系统提供，是天财商龙业务的核心入口，负责商户进件、关系绑定及分账指令发起。

| 接口路径与方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /api/v1/tiancai/merchants/onboarding` | 三代系统 | **天财业务商户进件**。为商户开通分账业务，配置结算模式、费率等信息。 | 请求：商户基本信息、业务配置。<br>响应：商户号、进件状态。 |
| `POST /api/v1/tiancai/bindings` | 三代系统 | **发起关系绑定**。触发付方（总部）与收方（门店/会员）的签约与认证流程，建立分账授权关系。 | 请求：付方、收方标识，业务场景。<br>响应：绑定任务ID、状态。 |
| `POST /api/v1/tiancai/split-orders/collection` | 三代系统 | **发起资金归集**。将门店的收款资金归集至总部账户。 | 请求：归集订单号、付方（门店）、收方（总部）、金额。<br>响应：分账指令号、状态。 |
| `POST /api/v1/tiancai/split-orders/batch-payment` | 三代系统 | **发起批量付款**。总部向其绑定的多个门店进行批量付款。 | 请求：批量付款订单号、付方（总部）、付款明细列表。<br>响应：分账指令号、状态。 |
| `POST /api/v1/tiancai/split-orders/member-settlement` | 三代系统 | **发起会员结算**。为会员消费进行结算，将资金从总部账户划转至会员账户。 | 请求：结算订单号、付方（总部）、收方（会员）、金额。<br>响应：分账指令号、状态。 |

### 4.1.2 电子签约与认证接口

此类接口由电子签约平台提供，为分账关系建立提供法律合规的授权基础，包括H5页面交互接口。

| 接口路径与方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /api/v1/contract/initiate` | 电子签约平台 | **发起签约认证**。由行业钱包系统调用，为指定用户创建签约任务。 | 请求：用户标识、签约类型。<br>响应：签约任务ID。 |
| `GET /api/v1/contract/task/{signTaskId}` | 电子签约平台 | **查询签约任务状态**。查询指定签约任务的当前状态与结果。 | 请求：路径参数 `signTaskId`。<br>响应：任务状态、协议信息、认证结果。 |
| `POST /api/v1/contract/open-payment-auth` | 电子签约平台 | **发起代付协议签署**。为付方（总部）发起开通批量付款权限的协议签署流程。 | 请求：付方商户信息、协议模板。<br>响应：签约流程ID。 |
| `GET /h5/v1/contract/data` | 电子签约平台 | **H5页面获取签约数据**。供前端H5页面加载签约所需的初始化数据。 | 请求：查询参数（如临时令牌）。<br>响应：用户信息、待签协议内容。 |
| `POST /h5/v1/contract/verify-sms` | 电子签约平台 | **H5页面提交短信验证码**。用户在H5页面完成短信验证码校验。 | 请求：短信验证码、会话标识。<br>响应：验证结果。 |

### 4.1.3 账户与账单查询接口

此类接口面向商户或运营人员，提供账户信息、交易流水及对账单的查询与下载服务。

| 接口路径与方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `GET /api/v1/accounts/{accountNo}` | 账户系统 | **查询账户详情**。查询指定账户的余额、状态等核心信息。 | 请求：路径参数 `accountNo`。<br>响应：账户详情、余额。 |
| `POST /api/v1/accounts/batch-query` | 账户系统 | **批量查询账户信息**。根据账户号列表批量查询账户信息。 | 请求：账户号列表。<br>响应：账户信息列表。 |
| `GET /api/v1/statement/split-orders` | 对账单系统 | **查询‘天财分账’指令账单**。按条件查询分账指令的汇总账单。 | 请求：查询条件（商户号、日期、状态等）。<br>响应：分账指令账单列表。 |
| `GET /api/v1/statement/account-transactions` | 对账单系统 | **查询机构动账明细**。查询指定商户的资金流水明细。 | 请求：查询条件（账户、时间范围）。<br>响应：资金流水明细列表。 |
| `GET /api/v1/statement/split-orders/{bizOrderNo}/detail` | 对账单系统 | **查询指定分账指令的完整明细**。查询单笔分账指令下的所有子订单或资金明细。 | 请求：路径参数 `bizOrderNo`。<br>响应：分账指令的完整明细。 |
| `POST /api/v1/statement/files/generate` | 对账单系统 | **触发生成指定日期的对账文件**。手动触发生成某日的对账汇总文件。 | 请求：对账日期、文件类型。<br>响应：文件生成任务ID。 |
| `GET /api/v1/statement/files` | 对账单系统 | **查询已生成的对账文件列表**。查询历史对账文件的生成记录及下载链接。 | 请求：查询条件（日期、状态）。<br>响应：对账文件信息列表。 |

## 4.2 模块间接口

模块间接口用于系统内部各微服务或组件之间的通信，通常通过内部网络调用，不直接对外暴露。接口设计强调稳定性、幂等性和清晰的职责边界。

### 4.2.1 账户与资金处理接口

此类接口围绕底层账户操作和资金划转，是分账业务资金流的基础。

| 接口路径与方法 | 调用方 -> 提供方 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /api/v1/accounts` | 三代系统/钱包APP -> **账户系统** | **创建账户**。为商户或用户创建底层资金账户。 | 请求：账户类型、所属主体信息。<br>响应：账户号、状态。 |
| `PUT /api/v1/accounts/{accountNo}/status` | 三代系统 -> **账户系统** | **更新账户状态**。冻结、解冻或注销指定账户。 | 请求：路径参数 `accountNo`， 请求体：目标状态。<br>响应：操作结果。 |
| `POST /api/v1/accounts/transfer` | 行业钱包系统/账务核心 -> **账户系统** | **账户间转账（内部调用）**。执行两底层账户之间的资金划转，保证事务性。 | 请求：付款账户、收款账户、金额、业务订单号。<br>响应：流水号、划转结果。 |
| `POST /api/v1/wallet/accounts`<br>`POST /api/v1/wallet/accounts/create` | 三代系统 -> **行业钱包系统**/**钱包APP** | **创建天财专用钱包账户**。在钱包层创建账户，并映射底层账户。 | 请求：商户信息、账户类型。<br>响应：钱包账户ID、状态。 |
| `POST /api/v1/wallet/transfer`<br>`POST /api/v1/wallet/transfers/execute` | 账务核心 -> **行业钱包系统**/**钱包APP** | **执行分账（资金划转）**。驱动钱包层及底层账户完成分账资金的实际划转。 | 请求：分账指令号、付方收方信息、金额。<br>响应：钱包订单号、受理状态。 |

### 4.2.2 分账业务与流程编排接口

此类接口用于驱动分账业务流程，涉及关系校验、指令执行、状态同步等。

| 接口路径与方法 | 调用方 -> 提供方 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /api/v1/auth/bindings` | 三代系统 -> **认证系统** | **发起付方与收方的关系绑定流程**。整合签约与认证，建立法律授权关系。 | 请求：付方、收方标识，业务场景。<br>响应：绑定关系ID、流程状态。 |
| `POST /api/v1/wallet/bindings/validate` | 账务核心 -> **行业钱包系统**/**钱包APP** | **校验绑定关系有效性**。在执行分账前，快速校验付方与收方是否存在有效授权。 | 请求：付方、收方标识，业务类型。<br>响应：校验结果（有效/无效）、失效原因。 |
| `POST /api/v1/split/execute`<br>`POST /api/v1/split/batch-execute` | 三代系统 -> **账务核心系统** | **执行（批量）分账**。接收业务指令，处理分账核心逻辑，并驱动资金划转。 | 请求：分账订单详情（付方、收方列表、金额）。<br>响应：分账处理结果、内部订单号。 |
| `POST /api/v1/split/validate-relationship` | 账务核心系统 -> **账务核心系统** (内部) | **校验分账关系**。内部逻辑接口，用于复核分账关系的合法性。 | 请求：付方、收方、业务场景。<br>响应：校验结果。 |
| `POST /api/v1/biz-core/trades/sync-split` | 行业钱包系统 -> **业务核心** | **同步分账交易数据**。将成功的分账交易数据同步至核心交易流水，需保证幂等。 | 请求：标准化的分账交易数据、唯一请求ID。<br>响应：同步状态、核心流水号。 |

### 4.2.3 清结算与计费接口

此类接口处理资金清算、结算、手续费计算等后端资金处理流程。

| 接口路径与方法 | 调用方 -> 提供方 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `PUT /internal/api/v1/settlement/config` | 三代系统 -> **清结算系统** | **更新商户结算配置**。设置或修改商户的结算周期、结算账户等配置。 | 请求：商户号、结算配置信息。<br>响应：更新结果。 |
| `POST /internal/api/v1/settlement/execute` | 定时任务/运营后台 -> **清结算系统** | **执行结算**。触发指定批次或商户的结算任务，完成资金出款。 | 请求：结算批次号或商户号、结算日期。<br>响应：结算任务ID。 |
| `POST /internal/api/v1/refund/process` | 业务核心/退货网关 -> **清结算系统** | **处理退货**。处理从天财收款账户发起的退货请求，进行资金逆向处理。 | 请求：原交易号、退货金额、退货原因。<br>响应：退货订单号、处理状态。 |
| `POST /api/v1/fee/calculate-and-charge` | 清结算系统 -> **计费中台** | **计算并执行手续费扣划**。基于分账交易信息计算手续费，并发起扣款。 | 请求：交易信息、商户费率标识。<br>响应：手续费订单号、计算金额。 |
| `POST /internal/api/v1/fee/callback/charge-result` | 清结算系统 -> **计费中台** | **手续费扣划结果回调**。通知计费中台手续费账户扣款的实际结果。 | 请求：手续费订单号、扣款状态、流水号。<br>响应：确认接收。 |
| `POST /internal/api/v1/fee/sync/config` | 三代系统 -> **计费中台** | **同步费率配置**。将商户进件或变更的费率规则同步至计费中台。 | 请求：商户号、费率规则详情。<br>响应：同步结果。 |

### 4.2.4 回调与状态同步接口

此类接口用于模块间的异步通知和状态同步，确保流程状态的一致性。

| 接口路径与方法 | 调用方 -> 提供方 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /api/v1/auth/callback/esign` | 电子签约平台 -> **认证系统** | **电子签约结果回调**。通知认证系统签约或身份认证的最终结果。 | 请求：签约任务ID、认证结果、证据文件。<br>响应：处理状态。 |
| `GET /api/v1/wallet/transfer-orders/{walletOrderNo}`<br>`GET /api/v1/wallet/transfers/{requestId}` | 账务核心/三代系统 -> **行业钱包系统**/**钱包APP** | **查询分账指令状态**。查询由钱包系统处理的资金划转指令的当前状态。 | 请求：路径参数（钱包订单号/请求ID）。<br>响应：指令状态、失败原因、完成时间。 |
| `GET /api/v1/split/orders/{splitOrderNo}` | 三代系统/对账单系统 -> **账务核心系统** | **查询分账订单详情**。查询分账核心系统处理的分账订单详细信息及资金明细。 | 请求：路径参数 `splitOrderNo`。<br>响应：订单详情、关联流水、状态历史。 |
| `GET /api/v1/fee/orders/{feeOrderNo}` | 清结算系统/运营后台 -> **计费中台** | **查询计费指令状态**。查询某笔手续费计算与扣款的详细状态。 | 请求：路径参数 `feeOrderNo`。<br>响应：计费详情、扣款状态、关联交易。 |