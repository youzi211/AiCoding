## 4.1 对外接口

本系统对外部系统（如行业钱包系统、三代系统、电子签约平台等）暴露的API接口，按功能分类如下：

### 4.1.1 账户管理接口
| 接口路径 | 方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- | :--- |
| `/api/v1/accounts/tiancai-special` | POST | 账户系统 | 为指定商户开立天财专用账户（收款账户或接收方账户）。 | 请求：商户信息、账户类型。响应：账户号、状态。 |
| `/api/v1/accounts/{accountNo}` | GET | 账户系统 | 查询账户详细信息，包括天财标记、账户类型、状态等。 | 响应：账户核心信息。 |
| `/api/v1/accounts/transaction-details` | POST | 账户系统 | 为对账单系统提供指定时间范围内指定类型账户的动账明细。 | 请求：账户列表、时间范围。响应：交易明细列表。 |
| `/api/v1/tiancai/accounts/open` | POST | 三代系统 | 为指定商户开立或升级天财专用账户（收款/接收方账户）。 | 请求：机构ID、商户信息、账户类型。响应：处理结果。 |
| `/api/v1/wallet/tiancai/accounts/open` | POST | 行业钱包系统 | 接收三代系统转发的天财专用账户开户或升级请求。 | 请求：三代系统请求报文。响应：处理结果。 |

### 4.1.2 关系与授权管理接口
| 接口路径 | 方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- | :--- |
| `/api/v1/tiancai/relations/bind` | POST | 三代系统 | 建立归集、批量付款、会员结算场景下的资金收付授权关系。 | 请求：关系类型、收付方信息。响应：关系ID、状态。 |
| `/api/v1/tiancai/payment/enable` | POST | 三代系统 | 在批量付款和会员结算场景下，为付方（总部）进行代付授权。 | 请求：付方信息、授权范围。响应：授权结果。 |
| `/api/v1/wallet/tiancai/relations/bind` | POST | 行业钱包系统 | 接收三代系统转发的‘关系绑定’或‘开通付款’请求。 | 请求：三代系统请求报文。响应：处理结果。 |
| `/api/v1/wallet/tiancai/relations/{relationId}` | GET | 行业钱包系统 | 查询指定绑定关系的详细信息及状态。 | 响应：关系详情。 |

### 4.1.3 交易与分账接口
| 接口路径 | 方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- | :--- |
| `/api/v1/tiancai/transfer` | POST | 业务核心 | 接收行业钱包系统发起的‘天财分账’交易指令。 | 请求：交易双方、金额、场景信息。响应：交易ID、状态。 |
| `/api/v1/tiancai/transfer/{transfer_id}` | GET | 业务核心 | 根据交易ID查询天财分账交易结果。 | 响应：交易详情及状态。 |
| `/api/v1/wallet/tiancai/transfers/split` | POST | 行业钱包系统 | 处理天财发起的‘天财分账’交易。 | 请求：分账指令。响应：处理结果。 |
| `/api/v1/settlement/tiancai-transfer` | POST | 清结算系统 | 执行天财专用账户间的资金分账（转账）。 | 请求：结算订单信息。响应：结算流水号。 |

### 4.1.4 结算与资金操作接口
| 接口路径 | 方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- | :--- |
| `/api/v1/settlement/active-settle` | POST | 清结算系统 | 触发主动结算，将商户待结算账户资金结算至其天财收款账户。 | 请求：商户信息、结算金额。响应：结算流水号。 |
| `/api/v1/settlement/account-freeze` | POST | 清结算系统 | 对指定天财账户进行资金冻结或解冻操作。 | 请求：账户号、操作类型、金额。响应：操作结果。 |
| `/api/v1/settlement/status/{settlementId}` | GET | 清结算系统 | 根据结算流水号查询结算执行状态。 | 响应：结算状态详情。 |

### 4.1.5 认证与签约接口
| 接口路径 | 方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- | :--- |
| `/api/v1/verification/remittance` | POST | 认证系统 | 发起打款验证。 | 请求：验证主体信息。响应：验证ID。 |
| `/api/v1/verification/remittance/confirm` | POST | 认证系统 | 确认打款验证。 | 请求：验证ID、打款金额。响应：确认结果。 |
| `/api/v1/verification/face` | POST | 认证系统 | 发起人脸验证。 | 请求：身份信息、人脸数据。响应：验证ID。 |
| `/api/v1/verification/{verificationId}` | GET | 认证系统 | 查询认证结果。 | 响应：认证状态及详情。 |
| `/api/v1/esign/process/initiate` | POST | 电子签约平台 | 行业钱包发起签约认证流程，触发短信发送并返回H5页面链接。 | 请求：签约方信息、协议内容。响应：流程ID、H5链接。 |
| `/api/v1/esign/process/{processId}` | GET | 电子签约平台 | 根据流程ID查询签约认证的详细状态和结果。 | 响应：流程状态、协议签署结果。 |

### 4.1.6 计费接口
| 接口路径 | 方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- | :--- |
| `/v1/billing/calculate` | POST | 计费中台 | 接收计费请求，计算手续费并返回结果。 | 请求：交易信息、计费场景。响应：手续费金额、明细。 |
| `/v1/billing/rules/notify` | POST | 计费中台 | 接收来自三代系统的计费规则变更通知，用于数据同步。 | 请求：规则变更数据。响应：同步结果。 |
| `/api/v1/tiancai/fee/config` | POST | 三代系统 | 为天财分账业务配置手续费规则。 | 请求：机构ID、规则详情。响应：配置结果。 |

### 4.1.7 账单与数据查询接口
| 接口路径 | 方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- | :--- |
| `/api/v1/tiancai/transfers` | GET | 业务核心 | 按时间范围查询天财分账交易明细，供对账单系统调用。 | 请求：时间范围、机构ID。响应：交易明细列表。 |
| `/api/v1/tiancai/org/{orgId}/merchants` | GET | 三代系统 | 为对账单系统提供天财机构下的商户列表。 | 响应：商户信息列表。 |
| `/api/v1/wallet/merchant-account/mapping` | POST | 行业钱包系统 | 为对账单系统提供批量查询商户与账户映射关系。 | 请求：商户ID列表。响应：商户-账户映射列表。 |
| `/api/v1/statements/org-query` | POST | 对账单系统 | 天财机构查询指定日期、类型的机构层级账单。 | 请求：机构ID、账单日期、类型。响应：账单汇总数据。 |
| `/api/v1/statements/org-file/generate` | POST | 对账单系统 | 触发生成指定日期和类型的机构账单文件。 | 请求：机构ID、账单日期、类型。响应：文件生成任务ID。 |
| `/api/v1/statements/push-status/{billDate}` | GET | 对账单系统 | 查询指定账单日期的各类动账明细数据推送完成状态。 | 响应：各数据源推送状态。 |

### 4.1.8 客户端服务接口
| 接口路径 | 方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- | :--- |
| `/api/v1/app/auth/login` | POST | 钱包APP/商服平台 | 商户登录并获取功能权限列表（如提现、结算模式切换是否可用）。 | 请求：登录凭证。响应：Token、权限列表。 |
| `/api/v1/app/account/overview` | GET | 钱包APP/商服平台 | 查询账户概览信息，包括余额、可用余额等。 | 响应：账户余额信息。 |
| `/api/v1/app/transaction/query` | POST | 钱包APP/商服平台 | 分页查询交易流水，支持按类型、时间筛选。 | 请求：查询条件、分页参数。响应：交易流水列表。 |
| `/api/v1/app/withdraw/apply` | POST | 钱包APP/商服平台 | 发起实时提现申请（对天财新机构商户禁用）。 | 请求：提现金额、银行卡信息。响应：提现申请结果。 |
| `/api/v1/app/settlement/mode` | GET | 钱包APP/商服平台 | 查询结算模式信息（对天财新机构商户仅可查看，不可修改）。 | 响应：当前结算模式及状态。 |

---

## 4.2 模块间接口

系统内部各模块之间用于业务协同和数据同步的关键调用接口。

### 4.2.1 认证与签约协同接口
| 接口路径 | 方法 | 调用方 | 被调用方 | 功能说明 |
| :--- | :--- | :--- | :--- | :--- |
| `/api/internal/esign/callback/verification` | POST | 认证系统 | 电子签约平台 | 供认证系统调用，异步通知电子签约平台验证结果，以推进签约流程。 |

### 4.2.2 数据同步与查询接口
| 接口路径 | 方法 | 调用方 | 被调用方 | 功能说明 |
| :--- | :--- | :--- | :--- | :--- |
| `内部调用` | - | 对账单系统 | 账户系统 | 调用账户系统的`POST /api/v1/accounts/transaction-details`接口，获取账户动账明细。 |
| `内部调用` | - | 对账单系统 | 业务核心 | 调用业务核心的`GET /api/v1/tiancai/transfers`接口，获取天财分账交易明细。 |
| `内部调用` | - | 对账单系统 | 行业钱包系统 | 调用行业钱包系统的`POST /api/v1/wallet/merchant-account/mapping`接口，获取商户账户映射。 |
| `内部调用` | - | 对账单系统 | 三代系统 | 调用三代系统的`GET /api/v1/tiancai/org/{orgId}/merchants`接口，获取机构下商户列表。 |
| `内部调用` | - | 业务核心 | 计费中台 | 在处理分账交易时，调用计费中台计算手续费。 |
| `内部调用` | - | 清结算系统 | 账户系统 | 在执行资金划拨时，调用账户系统进行账务处理。 |
| `内部调用` | - | 行业钱包系统 | 电子签约平台 | 在关系绑定时，调用电子签约平台发起签约流程。 |
| `内部调用` | - | 钱包APP/商服平台 | 账户系统/清结算系统 | 查询账户信息、发起结算等操作时，调用对应系统的内部接口。 |

> **说明**：模块间接口多为内部服务调用，其具体路径和格式由服务治理框架（如Spring Cloud Feign, Dubbo）定义。上表列出了关键的业务调用关系，实际实现中可能封装为本地方法调用或RPC调用。