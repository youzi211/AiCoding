[
  {
    "module_name": "账户系统",
    "purpose": "为天财分账业务提供专用的账户创建、管理、关系绑定、账务处理及能力控制的核心底层服务。",
    "interfaces": [
      {
        "method": "POST",
        "path": "/api/v1/tiancai/accounts",
        "description": "创建天财专用账户"
      },
      {
        "method": "POST",
        "path": "/api/v1/tiancai/accounts/{tiancai_account_id}/relationships",
        "description": "建立天财账户间的关系绑定"
      },
      {
        "method": "POST",
        "path": "/api/v1/accounts/{account_no}/ledger/entries",
        "description": "执行原子化的账务记账（内部调用）"
      },
      {
        "method": "GET",
        "path": "/api/v1/tiancai/accounts/{tiancai_account_id}",
        "description": "查询天财账户详情"
      },
      {
        "method": "GET",
        "path": "/api/v1/tiancai/accounts",
        "description": "根据条件查询天财账户列表"
      },
      {
        "method": "GET",
        "path": "/api/v1/tiancai/accounts/{tiancai_account_id}/relationships",
        "description": "查询账户关系"
      }
    ],
    "database_tables": [
      {
        "name": "tiancai_account",
        "description": "天财专用账户表，存储账户的业务属性、状态及与底层账户的关联。"
      },
      {
        "name": "account_relationship",
        "description": "账户关系表，记录天财账户间的授权绑定关系，用于分账前置校验。"
      },
      {
        "name": "account",
        "description": "底层标准账户表（已存在，需扩展），存储资金余额、状态和能力标记。"
      }
    ],
    "dependencies": [
      "三代系统",
      "行业钱包系统",
      "清结算系统"
    ],
    "key_features": [
      "天财专用账户生命周期管理",
      "账户关系绑定与校验",
      "原子化账务处理与余额管理",
      "通过事件驱动与上下游系统解耦"
    ]
  },
  {
    "module_name": "认证系统",
    "purpose": "为支付平台提供安全、合规的身份与账户所有权验证能力，确保资金流转方的身份真实性和账户控制权。",
    "interfaces": [
      {
        "method": "POST",
        "path": "/api/v1/verification/transfer-payment",
        "description": "发起打款验证，向指定银行卡打入随机金额以验证账户控制权。"
      },
      {
        "method": "POST",
        "path": "/api/v1/verification/transfer-payment/{verificationId}/confirm",
        "description": "提交用户回填的打款金额，以完成验证。"
      },
      {
        "method": "POST",
        "path": "/api/v1/verification/face",
        "description": "发起人脸识别验证请求，验证个人身份真实性。"
      },
      {
        "method": "GET",
        "path": "/api/v1/verification/{verificationId}",
        "description": "同步查询某次验证的详细状态和结果。"
      }
    ],
    "database_tables": [
      {
        "name": "verification_record",
        "description": "验证记录表，存储每一次验证请求的完整信息与状态。"
      },
      {
        "name": "transfer_payment_detail",
        "description": "打款验证明细表，为打款验证场景扩展存储打款执行细节。"
      }
    ],
    "dependencies": [
      "清结算系统",
      "电子签约平台",
      "消息队列(Kafka)",
      "行业钱包系统"
    ],
    "key_features": [
      "打款验证（对公/对私银行卡）",
      "人脸验证（姓名、身份证、人脸比对）",
      "认证状态管理与证据链追溯",
      "与电子签约平台集成完成关系绑定核验"
    ]
  },
  {
    "module_name": "计费中台",
    "purpose": "作为天财分账系统的核心计费引擎，负责对各类分账交易、账户操作进行精确的费用计算、冻结和结算处理。",
    "interfaces": [
      {
        "method": "POST",
        "path": "/v1/billing/calculate",
        "description": "计费试算接口，在业务发起前预先计算并返回费用明细。"
      },
      {
        "method": "POST",
        "path": "/v1/billing/confirm",
        "description": "费用确认与冻结接口，在业务正式执行前确认并冻结费用。"
      },
      {
        "method": "POST",
        "path": "/internal/v1/billing/settle",
        "description": "费用结算指令生成接口（内部），由调度任务触发，对已冻结费用生成结算指令。"
      }
    ],
    "database_tables": [
      {
        "name": "billing_rule",
        "description": "计费规则表，存储不同业务场景、角色的差异化计费规则。"
      },
      {
        "name": "billing_order",
        "description": "计费订单表，记录每笔业务产生的费用订单及状态。"
      },
      {
        "name": "billing_detail",
        "description": "计费明细表，记录费用订单的详细计算构成。"
      },
      {
        "name": "settlement_instruction",
        "description": "结算指令表，存储驱动资金划转的结算指令。"
      }
    ],
    "dependencies": [
      "行业钱包系统",
      "账户系统",
      "清结算系统",
      "对账单系统",
      "三代系统"
    ],
    "key_features": [
      "费率规则管理：支持为不同场景、角色、账户类型配置差异化计费规则。",
      "实时计费：在关键业务节点实时计算并冻结/扣除费用。",
      "批量结算：按周期汇总费用并生成结算指令，驱动资金划转。",
      "费用对账：生成详细的计费明细和汇总账单。",
      "计费豁免与优惠：支持基于特定条件的费用减免。"
    ]
  },
  {
    "module_name": "三代系统",
    "purpose": "作为天财分账业务的入口和协调中枢，负责接收业务请求、协调下游系统、管理业务流程并返回结果。",
    "interfaces": [
      {
        "method": "POST",
        "path": "/api/v1/tiancai/merchants/{merchant_no}/enable",
        "description": "为指定收单商户开通天财分账业务能力，触发天财专用账户创建流程。"
      },
      {
        "method": "POST",
        "path": "/api/v1/tiancai/split-orders",
        "description": "天财发起分账指令的统一入口，接收后转发给行业钱包系统处理。"
      },
      {
        "method": "GET",
        "path": "/api/v1/tiancai/split-orders/{split_order_id}",
        "description": "查询分账指令处理状态。"
      },
      {
        "method": "POST",
        "path": "/api/internal/tiancai/callback/process",
        "description": "供下游系统回调，通知异步流程状态变更。"
      }
    ],
    "database_tables": [
      {
        "name": "tiancai_merchant_config",
        "description": "天财商户配置表，存储商户的天财业务开通状态和配置。"
      },
      {
        "name": "tiancai_account_mapping",
        "description": "天财账户映射表，维护商户号与天财账户ID的映射关系。"
      },
      {
        "name": "tiancai_split_order",
        "description": "天财分账订单表，记录分账指令的请求、状态和处理结果。"
      },
      {
        "name": "tiancai_process_flow",
        "description": "天财业务流程表，管理账户开通、关系绑定等异步流程的状态。"
      }
    ],
    "dependencies": [
      "天财系统",
      "账户系统",
      "行业钱包系统",
      "电子签约平台"
    ],
    "key_features": [
      "商户天财业务开通与流程协调",
      "分账指令的统一接收与路由转发",
      "多系统异步流程的状态管理与协调"
    ]
  },
  {
    "module_name": "清结算系统",
    "purpose": "作为支付体系的资金处理核心，负责天财分账业务的交易清算、资金结算、计费及退货资金处理。",
    "interfaces": [
      {
        "method": "POST",
        "path": "/api/v1/settlement/instructions",
        "description": "接收结算指令，将资金从待结算账户结算至目标天财收款账户。"
      },
      {
        "method": "POST",
        "path": "/api/v1/refund/fund-adjustments",
        "description": "处理天财场景的退货资金调拨。"
      },
      {
        "method": "GET",
        "path": "/api/v1/settlement/instructions/{instruction_id}",
        "description": "查询结算指令状态。"
      },
      {
        "method": "GET",
        "path": "/api/v1/settlement/records",
        "description": "查询结算记录。"
      },
      {
        "method": "GET",
        "path": "/api/v1/refund/adjustments",
        "description": "查询退货资金调拨记录。"
      }
    ],
    "database_tables": [
      {
        "name": "settlement_instruction",
        "description": "结算指令表，记录结算指令的元数据和整体状态。"
      },
      {
        "name": "settlement_record",
        "description": "结算记录表，记录每笔具体的结算明细和结果。"
      },
      {
        "name": "refund_fund_adjustment",
        "description": "退货资金调拨表，记录退货相关的资金流转。"
      },
      {
        "name": "settlement_route",
        "description": "结算路由表，关联商户、待结算账户与天财收款账户。"
      }
    ],
    "dependencies": [
      "支付核心（三代系统）",
      "账户系统",
      "对账单系统",
      "行业钱包系统"
    ],
    "key_features": [
      "天财收款账户主动结算",
      "天财场景退货资金处理",
      "计费与清算文件生成",
      "与分账业务协同（事件驱动）"
    ]
  },
  {
    "module_name": "账务核心系统",
    "purpose": "处理天财分账业务中所有与天财专用账户相关的资金流转、记账、结算、分账等核心账务操作，确保资金变动的准确性、一致性和可追溯性。",
    "interfaces": [
      {
        "method": "POST",
        "path": "/api/v1/tiancai/split-orders",
        "description": "接收并执行天财分账指令（归集、批量付款、会员结算）"
      },
      {
        "method": "POST",
        "path": "/api/v1/tiancai/settlement-trigger",
        "description": "由清结算系统调用，触发将待结算账户资金结算至天财收款账户"
      },
      {
        "method": "POST",
        "path": "/api/v1/tiancai/refund-adjustment",
        "description": "处理涉及天财收款账户的退货资金调整"
      },
      {
        "method": "GET",
        "path": "/api/v1/tiancai/split-orders/{split_order_no}",
        "description": "查询分账指令状态及详情"
      },
      {
        "method": "GET",
        "path": "/api/v1/tiancai/accounts/{tiancai_account_id}/transactions",
        "description": "查询账户交易流水"
      },
      {
        "method": "POST",
        "path": "/api/v1/tiancai/internal/reconciliation",
        "description": "内部对账接口（日终批处理）"
      }
    ],
    "database_tables": [
      {
        "name": "tiancai_split_order",
        "description": "天财分账订单表，记录分账指令核心信息"
      },
      {
        "name": "account_transaction",
        "description": "账户交易流水表，记录所有资金变动的明细流水"
      },
      {
        "name": "settlement_instruction",
        "description": "结算指令记录表，记录结算触发指令"
      },
      {
        "name": "internal_reconciliation",
        "description": "内部对账表，支持日终对账与差错处理"
      }
    ],
    "dependencies": [
      "行业钱包系统",
      "清结算系统",
      "账户系统"
    ],
    "key_features": [
      "分账指令处理与资金划转",
      "结算资金处理",
      "退货资金调整",
      "账务流水生成与内部对账",
      "严格的资金操作校验与事务一致性保障"
    ]
  },
  {
    "module_name": "电子签约平台",
    "purpose": "为“天财分账”业务提供安全、合规、便捷的电子协议签署与身份认证集成服务。",
    "interfaces": [
      {
        "method": "POST",
        "path": "/api/v1/contracts/processes",
        "description": "创建签约流程"
      },
      {
        "method": "GET",
        "path": "/api/v1/contracts/processes/{processId}",
        "description": "查询签约流程状态"
      },
      {
        "method": "POST",
        "path": "/api/v1/webhook/verification",
        "description": "接收认证系统回调"
      },
      {
        "method": "GET",
        "path": "/api/v1/contracts/templates/preview",
        "description": "生成协议预览"
      }
    ],
    "database_tables": [
      {
        "name": "contract_process",
        "description": "签约流程主表"
      },
      {
        "name": "contract_party",
        "description": "签约参与方信息与进度表"
      },
      {
        "name": "contract_template",
        "description": "协议模板表"
      },
      {
        "name": "contract_document",
        "description": "已签署协议文件表"
      },
      {
        "name": "evidence_package",
        "description": "签约过程证据包表"
      }
    ],
    "dependencies": [
      "行业钱包系统",
      "认证系统",
      "短信网关",
      "对象存储",
      "时间戳服务"
    ],
    "key_features": [
      "法律合规的电子签约流程",
      "协议模板管理与渲染",
      "签约流程状态机管理",
      "完整的证据链留存",
      "与认证系统无缝集成"
    ]
  },
  {
    "module_name": "钱包APP/商服平台模块",
    "purpose": "作为天财分账业务的用户交互层，为天财机构、总部、门店等角色提供账户管理、关系绑定、分账业务发起与查询等全流程操作的前端平台。",
    "interfaces": [
      {
        "method": "GET",
        "path": "/api/v1/user/current",
        "description": "获取当前登录用户身份、机构及权限信息"
      },
      {
        "method": "GET",
        "path": "/api/v1/accounts",
        "description": "获取用户有权查看的天财专用账户列表"
      },
      {
        "method": "POST",
        "path": "/api/v1/relation-bindings/initiate",
        "description": "发起关系绑定流程，获取签约或认证链接"
      },
      {
        "method": "POST",
        "path": "/api/v1/split-orders",
        "description": "发起分账指令（归集、批量付款、会员结算）"
      },
      {
        "method": "GET",
        "path": "/api/v1/split-orders",
        "description": "分页查询分账订单列表"
      },
      {
        "method": "POST",
        "path": "/api/internal/callback/tiancai",
        "description": "接收三代系统异步回调，更新订单状态并通知用户"
      }
    ],
    "database_tables": [
      {
        "name": "user",
        "description": "用户表，存储用户身份、所属机构、角色及管理权限"
      },
      {
        "name": "frontend_split_order",
        "description": "前端分账订单表，关联三代订单，记录前端状态与表单数据"
      },
      {
        "name": "relation_binding_flow",
        "description": "关系绑定流程表，记录签约认证流程的步骤与状态"
      },
      {
        "name": "user_notification",
        "description": "用户通知表，存储待推送的业务通知"
      }
    ],
    "dependencies": [
      "三代系统",
      "行业钱包系统",
      "电子签约平台",
      "认证系统"
    ],
    "key_features": [
      "多角色用户门户与权限隔离",
      "引导式关系绑定流程（签约/认证）",
      "分账业务发起与状态跟踪",
      "交易查询与对账单下载"
    ]
  },
  {
    "module_name": "行业钱包系统",
    "purpose": "作为天财分账业务的核心业务逻辑处理引擎，负责处理天财账户开通、关系绑定、分账指令执行等核心流程。",
    "interfaces": [
      {
        "method": "POST",
        "path": "/api/v1/tiancai/accounts/{tiancai_account_id}/bindings",
        "description": "发起账户关系绑定流程"
      },
      {
        "method": "POST",
        "path": "/api/v1/tiancai/accounts/{tiancai_account_id}/open-payment",
        "description": "为总部开通付款权限"
      },
      {
        "method": "POST",
        "path": "/api/internal/tiancai/split-orders",
        "description": "处理分账指令（内部接口）"
      },
      {
        "method": "GET",
        "path": "/api/v1/tiancai/split-orders/{wallet_order_id}",
        "description": "查询分账订单详情"
      },
      {
        "method": "GET",
        "path": "/api/v1/tiancai/accounts/{tiancai_account_id}/bindings",
        "description": "查询账户绑定关系列表"
      },
      {
        "method": "POST",
        "path": "/api/internal/callback/esign",
        "description": "接收电子签约平台回调"
      }
    ],
    "database_tables": [
      {
        "name": "tiancai_wallet_account",
        "description": "钱包账户映射表，记录天财账户在钱包层的映射与状态"
      },
      {
        "name": "account_binding",
        "description": "账户关系绑定表，记录账户间的授权绑定关系"
      },
      {
        "name": "tiancai_split_order",
        "description": "钱包分账订单表，记录分账订单主信息"
      },
      {
        "name": "split_order_detail",
        "description": "分账订单明细表，记录每笔分账的收款方明细"
      }
    ],
    "dependencies": [
      "账户系统",
      "三代系统",
      "电子签约平台",
      "对账单系统"
    ],
    "key_features": [
      "天财账户开通与状态同步",
      "账户关系绑定与电子签约协调",
      "分账指令处理与业务规则校验",
      "支持归集、批量付款、会员结算三大场景",
      "事件驱动的状态管理与对账协同"
    ]
  },
  {
    "module_name": "业务核心",
    "purpose": "作为天财分账业务的业务编排与流程驱动引擎，协调下游服务，处理业务请求并确保流程一致性。",
    "interfaces": [
      {
        "method": "POST",
        "path": "/api/v1/tiancai/business/open",
        "description": "为指定商户开通天财分账业务"
      },
      {
        "method": "POST",
        "path": "/api/v1/tiancai/business/bindings",
        "description": "发起账户关系绑定业务请求"
      },
      {
        "method": "POST",
        "path": "/api/v1/tiancai/business/split-orders",
        "description": "发起分账业务请求"
      },
      {
        "method": "GET",
        "path": "/api/v1/tiancai/business/{business_id}",
        "description": "查询具体业务请求的详细状态和结果"
      },
      {
        "method": "POST",
        "path": "/api/v1/tiancai/business/reconciliations",
        "description": "按机构、日期、业务类型生成对账文件"
      }
    ],
    "database_tables": [
      {
        "name": "business_process",
        "description": "业务流程主表，记录业务请求和状态"
      },
      {
        "name": "business_phase",
        "description": "业务流程阶段表，记录各阶段执行详情"
      },
      {
        "name": "merchant_account_mapping",
        "description": "商户-账户映射表，关联商户号与天财账户ID"
      },
      {
        "name": "business_reconciliation",
        "description": "业务对账表，存储对账批次和文件信息"
      }
    ],
    "dependencies": [
      "三代系统",
      "行业钱包系统",
      "账户系统",
      "电子签约平台",
      "对账单系统"
    ],
    "key_features": [
      "业务流程编排与状态机管理",
      "商户-账户映射解析与转换",
      "业务异常处理与补偿",
      "业务对账与报表"
    ]
  },
  {
    "module_name": "对账单系统",
    "purpose": "为天财机构提供统一、准确、可追溯的资金流转视图，满足其对账、审计、财务核算和业务分析需求。",
    "interfaces": [
      {
        "method": "GET",
        "path": "/api/v1/tiancai/reconciliations",
        "description": "查询对账单列表，支持多维度筛选。"
      },
      {
        "method": "POST",
        "path": "/api/v1/tiancai/reconciliations/generate",
        "description": "触发对账文件的即时生成。"
      },
      {
        "method": "GET",
        "path": "/api/v1/tiancai/accounts/{tiancai_account_id}/ledger",
        "description": "查询指定天财账户的资金变动明细。"
      },
      {
        "method": "GET",
        "path": "/api/v1/tiancai/institutions/{institution_code}/summary",
        "description": "查询天财机构在指定日期的各类业务汇总数据。"
      },
      {
        "method": "POST",
        "path": "/api/internal/tiancai/reconciliations/verify",
        "description": "触发指定日期和业务类型的数据一致性校验。"
      }
    ],
    "database_tables": [
      {
        "name": "account_ledger",
        "description": "账户流水明细表，记录所有资金变动流水，是核心数据表。"
      },
      {
        "name": "reconciliation_file",
        "description": "对账文件表，存储已生成的对账文件元数据。"
      },
      {
        "name": "tiancai_account_info",
        "description": "天财账户信息表，存储账户基本信息用于关联查询。"
      },
      {
        "name": "daily_summary",
        "description": "日终汇总表，存储各类业务的每日汇总指标。"
      }
    ],
    "dependencies": [
      "账户系统",
      "清结算系统",
      "行业钱包系统",
      "文件存储服务"
    ],
    "key_features": [
      "多源数据采集与聚合",
      "多维度对账单生成与分发",
      "账户动账明细查询",
      "数据一致性校验与告警"
    ]
  }
]