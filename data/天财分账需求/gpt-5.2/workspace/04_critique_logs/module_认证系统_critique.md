# 批判日志: 认证系统

## 批判迭代 #1 - 2026-01-21 18:10:52

**模块**: 认证系统

**分数**: 0.00 / 1.0

**结果**: ❌ 未通过


### 发现的问题

- 接口设计为空（API端点、请求/响应结构、事件均为TBD）。请补齐至少打款验证发起、回填校验、人脸核验的具体HTTP方法、路径、鉴权方式、请求字段、响应字段、错误码与幂等策略。
- 数据模型为空（表/集合、关键字段均为TBD）。请定义验证流水（verification_id）、用户标识、银行卡要素、随机打款金额、状态机、重试次数、过期时间、第三方渠道流水号、审计字段等，并说明索引与唯一约束。
- 打款验证关键逻辑缺失：未定义金额生成范围与规则、回填次数上限、锁定与解锁策略、有效期与超时处理、重复发起的幂等键、并发回填的竞态处理。请补齐状态流转与边界条件。
- 人脸验证关键逻辑缺失：未定义活体检测要求、相似度阈值与可配置性、失败重试与冷却时间、图片/视频格式与大小限制、超时与回调模式、第三方不可用降级策略。请补齐可执行的校验与风控规则。
- 安全与合规要求缺失：未说明敏感信息（身份证号、人脸影像、银行卡号）的加密存储/传输、脱敏日志、访问控制、数据保留与删除策略、审计追踪。请补齐安全控制与合规约束。
- 与上游电子签约平台的交互契约不清：未定义同步/异步模式、回调或轮询机制、状态查询接口、幂等与重放保护。请明确契约与时序（含状态查询与回调）。
- 错误处理不够可落地：仅描述原则，缺少标准化错误码体系、可重试判定、重试退避策略、告警与监控指标（成功率、延迟、渠道错误率）。请补齐错误码与可观测性设计。


### 改进建议
按可交付标准补齐TBD部分并落地为可实现的接口与数据：1）定义REST接口清单：发起打款（含幂等键）、查询状态、提交回填、发起人脸核验、查询人脸结果；为每个接口给出字段级请求/响应示例与错误码。2）建立验证流水数据模型与状态机（INIT, TRANSFER_PENDING, TRANSFER_SUCCESS, VERIFY_SUCCESS, VERIFY_FAILED, EXPIRED, LOCKED等），明确过期时间、回填次数上限、并发控制与幂等规则。3）补齐人脸核验的活体、阈值、重试与降级策略，以及媒体格式限制与超时策略。4）补齐安全合规：PII加密、KMS密钥管理、日志脱敏、最小权限、审计与数据保留周期。5）补齐可观测性与运维：指标、日志、链路追踪、告警阈值、渠道熔断与重试退避。6）在时序图中补充状态查询/回调与失败分支，确保与接口契约一致。

---

