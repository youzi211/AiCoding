# 批判日志: 钱包APP/商服平台

## 批判迭代 #1 - 2026-01-21 18:11:00

**模块**: 钱包APP/商服平台

**分数**: 0.20 / 1.0

**结果**: ❌ 未通过


### 发现的问题

- 接口设计章节为TBD，缺少任何可评审的API端点、鉴权方式、请求/响应字段、错误码与幂等策略，导致前后端无法对齐与联调。
- 数据模型章节为TBD，未定义前端需要的核心展示与交互数据结构（如分账单、签约流程、账户信息、账单明细、草稿），也未说明缓存/本地存储与字段来源映射。
- 事件/通知机制描述不一致：业务逻辑写'轮询或接收通知'，但接口设计的事件为TBD，且时序图中ES直接通知APP，缺少明确的回调通道设计（WebHook到后端再转发、还是前端轮询钱包系统）。
- 依赖关系不完整：上游列出账户系统、对账单系统，但时序图未体现；下游模块为TBD，未说明与统一登录、风控、埋点、消息推送等常见前端依赖的边界与集成方式。
- 关键业务规则缺失：未定义场景枚举值与角色权限矩阵、手续费承担方/到账模式/资金用途等字段的前端校验与展示规则，也未说明与协议模板选择的映射关系。
- 缺少关键失败与安全考虑：未说明登录与会话管理、接口签名/Token刷新、敏感信息脱敏、重放与CSRF防护；也未定义签约H5跳转的回跳参数校验与防篡改。
- 草稿与断点续办仅一句话，缺少可执行方案：保存范围、加密、过期策略、跨设备同步与冲突处理、恢复入口与状态机定义均未给出。
- 时序图虽可渲染，但流程可行性不足：认证系统被ES调用的前提与接口边界未说明（是否允许ES直连AS），且缺少钱包系统侧对签约结果的落库与APP查询路径，导致状态一致性无法保证。


### 改进建议
补齐可落地的接口与数据定义：1）列出核心API清单（签约初始化、获取签约页、查询签约状态、发起归集/批付/会员结算、查询交易、查询账单、查询账户与关系、获取错误码映射），为每个接口给出方法、路径、鉴权、幂等键、分页、超时与重试策略、错误码；2）定义前端领域模型与页面所需字段（账户、关系、签约流程、交易单、批次、账单、草稿），明确字段来源与状态枚举；3）明确状态更新机制二选一并画全链路：前端轮询钱包系统（给出轮询间隔与终止条件）或后端接收ES回调再推送/前端查询（给出回调验签与一致性策略）；4）补充权限与规则矩阵（总部/门店在各场景可见性、必填字段、资金用途与协议模板映射、手续费承担方与到账模式展示/校验）；5）补充安全与可靠性（登录会话、Token刷新、H5回跳校验、敏感数据脱敏、草稿加密与过期、失败重试与幂等、批量提交的部分失败处理与可重试粒度）。

---

