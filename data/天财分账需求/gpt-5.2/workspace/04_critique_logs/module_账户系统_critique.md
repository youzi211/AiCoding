# 批判日志: 账户系统

## 批判迭代 #1 - 2026-01-21 18:11:02

**模块**: 账户系统

**分数**: 0.00 / 1.0

**结果**: ❌ 未通过


### 发现的问题

- 接口设计为空（API端点、请求/响应、事件均为TBD），无法评审对外契约与幂等、鉴权、版本管理等关键点。
- 数据模型为空（表/集合、关键字段均为TBD），无法验证账户唯一性、状态机、能力配置等规则如何落库与约束。
- 关键业务规则缺失：未定义账户唯一性维度（按商户+角色+场景？）与幂等键/重复请求处理策略，无法保证不重复开户。
- 关键状态机缺失：仅提到冻结/注销等异常，但未定义账户状态枚举、允许的状态迁移、各状态下允许的操作与返回码。
- 与下游通知机制不明确：时序图中有'通知账户开通完成'，但接口设计的事件/回调为TBD，缺少可靠投递（重试、去重、死信）与一致性方案。
- 与上游三代的数据对齐缺失：未说明三代提供的商户/开户信息字段、校验规则、以及不一致时的主数据归属与冲突解决策略。
- 错误处理过于笼统：提到重试与事务补偿，但未定义跨系统一致性边界（本地事务+Outbox/Saga等）、重试退避、幂等与补偿触发条件。
- 能力配置描述不落地：如'支持分账、绑定多张银行卡、设置默认提现卡'未明确哪些能力由账户系统控制、哪些由钱包系统控制，缺少能力模型与权限校验点。
- 缺少安全与合规要求：未定义鉴权（调用方身份、签名/Token）、敏感字段保护、审计日志与权限隔离，账户系统作为底层能力风险较高。
- 缺少非功能性指标：未给出SLA、超时、限流、并发开户峰值、数据库唯一索引与性能方案，影响可行性评估。


### 改进建议
补齐可评审的最小可行设计：1）接口设计：明确REST端点（如开户、查询、变更状态、配置能力）、请求/响应字段、错误码、幂等键（例如requestId或merchantId+role+scene）、鉴权方式与版本策略；同时定义对钱包系统的通知方式（事件或回调）及其可靠性（Outbox、重试、去重、死信）。2）数据模型：给出账户表、账户能力表、账户标签/角色表、状态变更流水表等核心表结构与关键字段（accountId、merchantId、roleType、scene、status、capabilities、createdAt等），并用唯一索引/约束落地'唯一性'规则。3）业务逻辑：定义账户状态枚举与状态迁移图，明确各场景（归集/批付/会员结算）开户时的初始状态与必填关联关系；给出重复开户、并发请求、下游不可用时的处理流程。4）一致性与失败处理：明确跨系统一致性方案（例如本地事务+Outbox发布事件，钱包消费幂等；或Saga补偿），定义重试策略（次数、退避、可重放）与补偿动作。5）边界与职责：明确账户系统与钱包系统在'绑卡/默认卡/能力开关'上的职责边界与权限校验点，并补充安全、审计与非功能指标。

---

