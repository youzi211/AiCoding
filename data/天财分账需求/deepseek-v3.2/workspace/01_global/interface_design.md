## 4.1 对外接口
此部分列出系统向外部系统（如商户、运营人员、天财系统等）提供的服务接口。

### 4.1.1 商户与业务开通接口
此类接口主要由三代系统对外提供，用于处理商户开户、关系绑定、业务审核等核心业务流程。

| 接口路径与方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /api/v1/tiancai/account/open` | 三代系统 | 为收单商户开立或升级天财专用账户（收款/接收方账户）。 | 请求：商户信息、账户类型等。响应：账户开立结果、账户号。 |
| `POST /api/v1/tiancai/relationship/bind` | 三代系统 | 发起归集、批量付款或会员结算场景下的授权关系建立流程。 | 请求：授权方、被授权方信息、场景类型。响应：签约流程ID或关系建立结果。 |
| `POST /api/v1/tiancai/business/audit` | 三代系统 | 内部运营审核天财商户的业务开通申请。 | 请求：申请ID、审核结果、备注。响应：审核操作结果。 |
| `GET /api/v1/tiancai/query/account-details` | 三代系统 | 查询待结算账户或收款账户的动账明细，供对账使用。 | 请求：账户号、日期范围。响应：账户动账明细列表。 |

### 4.1.2 认证与签约接口
此类接口由认证系统和电子签约平台提供，用于完成身份核验和电子协议签署。

| 接口路径与方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /api/v1/verification/transfer` | 认证系统 | 发起打款验证，生成小额打款指令。 | 请求：用户身份信息、银行卡号。响应：验证流水ID。 |
| `POST /api/v1/verification/transfer/confirm` | 认证系统 | 验证用户回填的打款金额和备注信息。 | 请求：验证流水ID、回填金额、备注。响应：验证结果。 |
| `POST /api/v1/verification/face` | 认证系统 | 发起人脸核验请求，返回验证令牌。 | 请求：用户身份信息、人脸照片/视频。响应：验证令牌、流水ID。 |
| `POST /api/v1/verification/face/result` | 认证系统 | 接收并处理人脸核验结果。 | 请求：流水ID、第三方核验结果。响应：处理状态。 |
| `GET /api/v1/verification/{verificationId}` | 认证系统 | 根据流水ID查询认证结果详情。 | 请求：验证流水ID。响应：认证记录详情。 |
| `GET /api/v1/esign/h5/{processId}` | 电子签约平台 | 用户点击短信链接后访问的H5页面入口，用于查看和签署协议。 | 请求：签约流程ID。响应：H5页面内容。 |
| `POST /api/v1/esign/process/{processId}/confirm` | 电子签约平台 | H5页面中，用户完成协议签署时调用，确认签署。 | 请求：签约流程ID、签署人信息。响应：签署确认结果。 |

### 4.1.3 业务处理与查询接口
此类接口由业务核心、对账单系统、行业钱包系统等提供，用于处理交易指令、查询账单等。

| 接口路径与方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /api/v1/tiancai/transfer` | 行业钱包系统 | 天财系统发起资金分账指令。 | 请求：分账指令详情（付款方、收款方、金额等）。响应：交易受理结果、交易流水号。 |
| `POST /api/v1/tiancai/transfer/notify` | 业务核心 | 接收行业钱包系统异步推送的分账交易结果通知。 | 请求：交易结果通知（流水号、状态、完成时间等）。响应：接收确认。 |
| `GET /api/v1/tiancai/transfer/records` | 业务核心 | 供对账单系统按机构、日期范围查询分账交易记录。 | 请求：机构号、开始日期、结束日期。响应：分账交易记录列表。 |
| `GET /api/v1/tiancai/statements/batch` | 对账单系统 | 批量获取账户动账明细文件，供天财系统拉取D-1日完整账单。 | 请求：机构号、账单日期。响应：账单文件下载地址或文件流。 |
| `GET /api/v1/tiancai/statements/transfer` | 对账单系统 | 查询指定日期范围内的机构天财分账指令账单。 | 请求：机构号、开始日期、结束日期。响应：分账指令账单列表。 |
| `POST /api/v1/tiancai/statements/push-callback` | 对账单系统 | （可选）账单就绪后回调天财系统的接口，通知文件下载地址。 | 请求：机构号、账单日期、文件地址。响应：回调接收确认。 |

### 4.1.4 计费服务接口
此类接口由计费中台提供，用于规则管理和实时计费。

| 接口路径与方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /api/v1/tiancai/fee/rule/config` | 计费中台 | 由三代系统调用，用于创建、更新或失效计费规则。 | 请求：计费规则详情。响应：规则配置结果。 |
| `POST /api/v1/tiancai/fee/calculate` | 计费中台 | 由行业钱包系统调用，为单笔分账交易实时计算手续费。 | 请求：交易金额、商户信息、业务场景。响应：手续费金额、费率详情。 |
| `GET /api/v1/tiancai/fee/rule/query` | 计费中台 | 供三方系统查询生效的计费规则。 | 请求：商户ID、业务场景。响应：生效的计费规则列表。 |

### 4.1.5 前端适配接口
此类接口由天财业务适配模块提供，用于控制功能入口和界面跳转。

| 接口路径与方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `GET /api/v1/merchant/features` | 天财业务适配模块 | 查询当前登录商户的可使用功能列表，根据机构号动态返回。 | 请求：用户令牌。响应：功能列表（含天财业务入口）。 |
| `POST /api/v1/tiancai/redirect` | 天财业务适配模块 | 获取天财业务H5页面的跳转URL和参数，用于在APP内嵌WebView打开。 | 请求：目标页面标识、上下文参数。响应：跳转URL及安全参数。 |
| `POST /api/v1/operation/precheck` | 天财业务适配模块 | 在执行关键操作前进行预校验，返回是否允许操作及原因。 | 请求：操作类型、操作对象。响应：校验结果、提示信息。 |

## 4.2 模块间接口
此部分列出系统内部各模块之间相互调用的接口。

### 4.2.1 账户与资金管理接口
此类接口围绕账户的创建、查询、资金划转等操作。

| 接口路径与方法 | 调用方 -> 提供方 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /internal/v1/accounts/tiancai` | 三代系统/行业钱包系统 -> 账户系统 | 为指定商户创建或升级天财专用账户（收款/接收方账户）。 | 请求：商户ID、账户类型。响应：账户号、账户信息。 |
| `GET /internal/v1/accounts/{accountNo}/tags` | 行业钱包系统/清结算系统 -> 账户系统 | 查询指定账户的标记信息，判断是否为天财专用账户。 | 请求：账户号。响应：账户标记列表。 |
| `POST /internal/v1/transfers/tiancai` | 行业钱包系统 -> 账户系统 | 执行从天财收款账户到另一个天财专用账户的资金划转。 | 请求：付款账户、收款账户、金额、业务流水号。响应：划转结果。 |
| `GET /internal/v1/accounts/{accountNo}/statements` | 对账单系统/三代系统 -> 账户系统 | 查询账户余额及动账明细流水。 | 请求：账户号、日期范围。响应：账户流水列表。 |
| `POST /internal/v1/tiancai/account/open` | 三代系统 -> 行业钱包系统 | 为收单商户开立或升级天财专用账户。 | 请求：商户信息。响应：账户开立结果。 |
| `POST /internal/v1/tiancai/relationship/bind` | 三代系统 -> 行业钱包系统 | 发起归集、批量付款或会员结算场景下的授权关系建立流程。 | 请求：授权关系信息。响应：流程启动结果。 |
| `POST /internal/v1/tiancai/payment/enable` | 三代系统 -> 行业钱包系统 | 为付方（总部）开通批量付款和会员结算能力的前置授权。 | 请求：付方信息、授权范围。响应：授权结果。 |
| `GET /internal/v1/tiancai/relationship/status` | 三代系统 -> 行业钱包系统 | 查询关系绑定或开通付款的状态。 | 请求：关系ID或业务流水号。响应：关系状态详情。 |

### 4.2.2 清算、结算与退货接口
此类接口用于处理资金清算、结算配置、退货资金处理等。

| 接口路径与方法 | 调用方 -> 提供方 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /internal/v1/settlement/merchant/config` | 三代系统 -> 清结算系统 | 接收三代系统同步的商户结算账户配置变更（如切换为天财收款账户）。 | 请求：商户ID、结算账户配置。响应：配置更新结果。 |
| `GET /internal/v1/settlement/refund/target-account` | 支付核心/业务核心 -> 清结算系统 | 退货前置流程调用，查询指定商户的退货终点账户（天财收款账户）信息及余额。 | 请求：原交易流水号或商户ID。响应：退货目标账户信息、可用余额。 |
| `POST /internal/v1/settlement/refund/deduct` | 支付核心/业务核心 -> 清结算系统 | 退货前置流程确认后，从终点账户（天财收款账户）或退货账户扣减资金。 | 请求：扣款账户、金额、业务流水号。响应：扣款结果。 |
| `GET /internal/v1/settlement/accounts/{accountType}/statements` | 对账单系统 -> 清结算系统 | 为对账单系统提供待结算账户（01）、退货账户（04）的动账明细。 | 请求：账户类型、日期范围。响应：内部账户流水列表。 |

### 4.2.3 签约与认证协同接口
此类接口用于模块间协同完成签约流程和身份认证。

| 接口路径与方法 | 调用方 -> 提供方 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /api/v1/esign/process/initiate` | 行业钱包系统 -> 电子签约平台 | 发起签约流程总入口，由行业钱包系统调用。 | 请求：签约方信息、协议模板、回调地址。响应：签约流程ID。 |
| `GET /api/v1/esign/process/{processId}` | 行业钱包系统/认证系统 -> 电子签约平台 | 根据流程ID查询签约流程的详细状态和结果。 | 请求：签约流程ID。响应：流程状态、签署方信息。 |
| `POST /api/v1/esign/callback/verification` | 认证系统 -> 电子签约平台 | 接收认证系统回调，更新签约流程状态（如认证通过后触发协议签署）。 | 请求：签约流程ID、认证结果。响应：状态更新结果。 |

### 4.2.4 数据查询与同步接口
此类接口用于模块间的数据拉取和状态同步。

| 接口路径与方法 | 调用方 -> 提供方 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `GET /internal/v1/accounts/{accountNo}/statements` | 清结算系统 -> 账户系统 | 同4.2.1，清结算系统查询账户流水以完成清算。 | 同4.2.1。 |
| `GET /api/v1/tiancai/transfer/records` | 对账单系统 -> 业务核心 | 同4.1.3，对账单系统拉取分账交易记录。 | 同4.1.3。 |
| `GET /internal/v1/settlement/accounts/{accountType}/statements` | 对账单系统 -> 清结算系统 | 同4.2.2，对账单系统拉取内部账户流水。 | 同4.2.2。 |