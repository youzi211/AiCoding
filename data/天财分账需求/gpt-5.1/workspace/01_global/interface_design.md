# 4. 接口设计

## 4.1 对外接口
指系统向外部合作方（如天财商龙）或外部商户（通过前端渠道）提供的服务接口。

### 4.1.1 业务接入接口
由三代系统对外提供，是天财分账业务的主要对外入口。

| 接口路径与方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /api/v1/tiancai/accounts/open` | 三代系统 | 为天财机构下的商户开通天财专用账户。 | 请求：商户信息、机构标识。<br>响应：受理结果、请求流水号。 |
| `POST /api/v1/tiancai/relationships/bind` | 三代系统 | 建立分账付方（如门店）与收方（如总部）之间的授权关系。 | 请求：付方、收方账户信息，授权场景。<br>响应：受理结果、签约流程ID。 |
| `POST /api/v1/tiancai/payment/enable` | 三代系统 | 在批量付款和会员结算场景下，付方（总部）需额外进行的代付授权流程。 | 请求：付方账户信息，授权场景。<br>响应：受理结果、签约流程ID。 |
| `POST /api/v1/tiancai/split` | 三代系统 | 执行天财专用账户间的资金划转（分账）。 | 请求：付方、收方账户，金额，业务场景，业务订单号。<br>响应：受理结果、分账订单号。 |
| `GET /api/v1/tiancai/audit/status` | 三代系统 | 查询商户开通天财分账业务的审核状态。 | 请求：商户号、请求流水号。<br>响应：审核状态、详情。 |

### 4.1.2 商户自助服务接口
由前端渠道（钱包APP/商服平台）提供，供商户查询和管理业务。

| 接口路径与方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /api/v1/channel/auth/login` | 前端渠道 | 商户登录，返回Token、机构标识及功能黑名单。 | 请求：登录凭证。<br>响应：Token、商户信息、功能权限。 |
| `GET /api/v1/channel/tiancai/account/overview` | 前端渠道 | 获取天财专用账户的核心概览信息（余额、状态等）。 | 请求：Token。<br>响应：账户余额、状态、开户时间等。 |
| `GET /api/v1/channel/tiancai/transactions` | 前端渠道 | 分页查询账户的资金流水（分账、收单结算等）。 | 请求：Token、时间范围、分页参数。<br>响应：交易流水列表。 |
| `GET /api/v1/channel/tiancai/business/status` | 前端渠道 | 查询关键业务处理状态（如开户审核、关系绑定）。 | 请求：Token、业务类型、请求流水号。<br>响应：业务处理状态及进度。 |
| `GET /api/v1/channel/tiancai/relationships` | 前端渠道 | 查询当前商户已建立的绑定关系（作为付方或收方）。 | 请求：Token。<br>响应：绑定关系列表。 |

### 4.1.3 账单服务接口
由对账单系统提供，供天财机构获取账单数据。

| 接口路径与方法 | 所属模块 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `GET /api/v1/tiancai/statements` | 对账单系统 | 为三代系统提供天财机构维度的账单数据查询入口。 | 请求：机构号、日期、账单类型。<br>响应：账单汇总及明细数据。 |
| `POST /api/v1/tiancai/statements/file` | 对账单系统 | 按天财要求的文件格式（如CSV）生成账单文件，并返回下载链接。 | 请求：机构号、日期、文件格式。<br>响应：文件生成任务ID、下载链接。 |

## 4.2 模块间接口
指系统内部各微服务或模块之间相互调用的接口。

### 4.2.1 账户与资金管理类

| 接口路径与方法 | 调用方 -> 提供方 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /internal/accounts/tiancai` | 行业钱包系统 -> 账户系统 | 创建天财专用账户。 | 请求：商户信息、机构信息。<br>响应：账户号、账户详情。 |
| `PUT /internal/accounts/{accountNo}/upgrade-to-tiancai` | 行业钱包系统 -> 账户系统 | 将普通账户升级为天财专用账户。 | 请求：账户号。<br>响应：升级后账户详情。 |
| `POST /internal/accounts/{accountNo}/book` | 行业钱包系统/清结算系统 -> 账户系统 | 执行账户资金的借记或贷记记账。 | 请求：账户号、金额、交易类型、业务流水号。<br>响应：记账结果、流水号。 |
| `PUT /internal/accounts/{accountNo}/freeze-status` | 清结算系统 -> 账户系统 | 更新账户的冻结状态。 | 请求：账户号、冻结/解冻指令、原因。<br>响应：操作结果。 |
| `GET /internal/accounts/{accountNo}` | 行业钱包系统/清结算系统 -> 账户系统 | 查询账户详情。 | 请求：账户号。<br>响应：账户核心信息、余额、状态。 |
| `POST /internal/settlement/account-config` | 三代系统 -> 清结算系统 | 同步商户结算账户配置（天财收款账户）。 | 请求：商户号、天财账户信息。<br>响应：同步结果。 |
| `GET /internal/settlement/refund-endpoint-account` | 退货前置系统 -> 清结算系统 | 查询退货终点账户信息（天财收款账户）。 | 请求：原交易信息。<br>响应：退货终点账户号。 |
| `POST /internal/settlement/fee-deduction` | 行业钱包系统 -> 清结算系统 | 执行分账手续费扣划。 | 请求：分账订单号、手续费金额、账户信息。<br>响应：扣划结果。 |
| `POST /internal/settlement/account-freeze` | 风控系统 -> 清结算系统 | 执行账户冻结/解冻。 | 请求：账户号、冻结指令、风控事件号。<br>响应：操作结果。 |
| `POST /internal/settlement/detail/batch` | 对账单系统 -> 清结算系统 | 批量查询结算明细。 | 请求：账户列表、时间范围。<br>响应：结算明细列表。 |

### 4.2.2 业务逻辑与流程协同类

| 接口路径与方法 | 调用方 -> 提供方 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /internal/tiancai/accounts/open` | 三代系统 -> 行业钱包系统 | 为天财机构下的商户开通或升级天财专用账户。 | 请求：商户信息、机构标识。<br>响应：受理结果、钱包层账户信息。 |
| `POST /internal/tiancai/relationships/bind` | 三代系统 -> 行业钱包系统 | 建立分账付方与收方之间的授权关系，或开通代付授权。 | 请求：付方、收方信息，授权场景。<br>响应：受理结果、绑定请求ID。 |
| `POST /internal/tiancai/split/execute` | 三代系统 -> 行业钱包系统 | 执行天财专用账户间的资金划转（分账）。 | 请求：分账指令详情。<br>响应：分账执行结果、订单号。 |
| `GET /internal/tiancai/relationships/status` | 三代系统 -> 行业钱包系统 | 查询特定绑定关系的状态。 | 请求：绑定关系ID或付方/收方账户。<br>响应：关系状态、详情。 |
| `GET /internal/tiancai/accounts/{accountNo}/detail` | 三代系统 -> 行业钱包系统 | 查询天财账户的详细信息。 | 请求：账户号。<br>响应：钱包层账户附加信息。 |
| `POST /v1/sign/initiate` | 行业钱包系统 -> 电子签章系统 | 发起签约认证流程。 | 请求：签约方信息、协议模板ID、业务场景。<br>响应：签约流程ID。 |
| `GET /v1/sign/status/{signFlowId}` | 行业钱包系统/三代系统 -> 电子签章系统 | 查询指定签约流程的当前状态。 | 请求：签约流程ID。<br>响应：签约状态、下一步动作。 |
| `GET /v1/evidence/{evidenceChainId}` | 内部审计 -> 电子签章系统 | 获取指定签约流程的完整证据链数据。 | 请求：证据链ID。<br>响应：协议、认证、短信等全流程证据。 |
| `POST /api/v1/fee/calculate` | 行业钱包系统 -> 计费中台 | 在分账交易执行前实时计算应收手续费。 | 请求：交易金额、业务场景、参与方信息。<br>响应：手续费金额、计费规则ID。 |
| `POST /api/v1/fee/rules/sync` | 三代系统 -> 计费中台 | 同步费率配置规则至计费中台。 | 请求：费率规则列表。<br>响应：同步结果。 |

### 4.2.3 交易记录与数据同步类

| 接口路径与方法 | 调用方 -> 提供方 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /internal/transactions/tiancai-split` | 行业钱包系统 -> 账务核心系统 | 接收并记录一笔天财分账交易，接口幂等。 | 请求：分账交易核心信息。<br>响应：记录结果、账务核心流水号。 |
| `POST /internal/transactions/verification-transfer` | 认证系统 -> 账务核心系统 | 接收并记录一笔用于身份验证的小额打款交易，接口幂等。 | 请求：打款验证交易信息。<br>响应：记录结果、交易流水号。 |
| `POST /internal/transactions/tiancai-split/query` | 对账单系统 -> 账务核心系统 | 根据时间范围和机构号，批量查询天财分账交易记录。 | 请求：机构号、时间范围、分页参数。<br>响应：分账交易记录列表。 |
| `POST /internal/tiancai/split/record` | 行业钱包系统 -> 业务核心 | 接收并持久化分账交易完成数据，实现幂等处理。 | 请求：分账订单完整数据。<br>响应：持久化结果、业务核心订单号。 |
| `PUT /internal/tiancai/split/record/{bizCoreSplitNo}/status` | 行业钱包系统 -> 业务核心 | 更新已记录交易的状态（如冲正）。 | 请求：业务核心订单号、新状态。<br>响应：更新结果。 |
| `GET /internal/tiancai/split/records` | 对账单系统 -> 业务核心 | 提供多条件、分页的天财分账交易数据查询。 | 请求：查询条件（账户、时间、状态等）。<br>响应：交易数据列表。 |
| `GET /internal/tiancai/split/summary` | 对账单系统 -> 业务核心 | 提供指定机构、日期的分账交易汇总数据。 | 请求：机构号、日期。<br>响应：交易笔数、总金额等汇总信息。 |

### 4.2.4 认证与风控类

| 接口路径与方法 | 调用方 -> 提供方 | 功能说明 | 请求/响应格式 |
| :--- | :--- | :--- | :--- |
| `POST /api/v1/auth/remittance/initiate` | 电子签章系统 -> 认证系统 | 发起小额打款验证。 | 请求：收款账户信息、验证场景。<br>响应：认证请求ID、打款金额/备注（供后续验证）。 |
| `POST /api/v1/auth/remittance/verify` | 电子签章系统 -> 认证系统 | 验证用户回填的打款金额和备注。 | 请求：认证请求ID、用户回填信息。<br>响应：验证结果。 |
| `POST /api/v1/auth/face/verify` | 电子签章系统 -> 认证系统 | 发起人脸验证。 | 请求：身份信息、人脸图像或标识。<br>响应：认证请求ID。 |
| `GET /api/v1/auth/result/{authId}` | 电子签章系统/行业钱包系统 -> 认证系统 | 查询认证结果。 | 请求：认证请求ID。<br>响应：认证状态、详情（如分数、时间）。 |