## 2.1 系统结构

本系统采用分层架构，旨在为“天财”业务平台提供资金账户管理、分账结算、批量付款等核心能力。系统以“行业钱包”作为核心业务中台，协调“账户系统”、“清结算”、“账务核心”等底层服务，并通过“三代”系统与外部业务平台对接，实现业务受理、审核与指令转发。整体架构强调职责分离、服务解耦与事务最终一致性。

```mermaid
graph TB
    subgraph "外部系统层"
        A[天财业务平台]
        F[交易系统]
    end

    subgraph "业务接入与网关层"
        B[三代系统]
        T[业务核心]
    end

    subgraph "核心业务中台"
        C[行业钱包]
        D[清结算系统]
        E[账户系统]
        G[账务核心]
    end

    subgraph "支撑服务层"
        H[电子签约平台]
        I[计费中台]
        J[认证系统]
        K[代付系统]
        L[风控系统]
    end

    subgraph "数据服务层"
        M[对账单系统]
    end

    A --> B
    F --> D
    B --> C
    T --> C
    C --> D
    C --> E
    C --> H
    C --> I
    C --> J
    C --> T
    D --> E
    D --> G
    D --> I
    D --> M
    E --> G
    H --> J
    K --> E
    K --> I
    K --> H
    L --> D
    L --> E
    M --> D
    M --> C
```

## 2.2 功能结构

系统功能围绕账户管理、资金处理、风险控制与数据服务四大领域展开。核心功能模块包括由“行业钱包”提供的账户与关系管理、由“清结算”处理的资金清分与结算、由“风控”执行的冻结操作，以及由“对账单系统”提供的数据服务。

```mermaid
graph TD
    A[天财资金处理系统]

    A --> B[账户管理]
    A --> C[资金处理]
    A --> D[风险控制]
    A --> E[数据服务]

    B --> B1[账户开户与维护]
    B --> B2[绑定关系管理]
    B --> B3[账户状态管理]

    C --> C1[分账处理]
    C --> C2[资金归集]
    C --> C3[会员结算]
    C --> C4[批量付款]
    C --> C5[交易清分结算]
    C --> C6[手续费计算]

    D --> D1[交易资金冻结]
    D --> D2[商户账户冻结]

    E --> E1[对账单生成]
    E --> E2[交易流水查询]
```

## 2.3 网络拓扑图

TBD

## 2.4 数据流转

系统数据流转以业务请求为驱动，始于“天财”或“三代”的业务指令，经由“业务核心”或“行业钱包”进行业务编排，最终在“账户系统”与“账务核心”完成资金账务处理。关键数据流包括开户流、分账流、结算流和冻结流。

```mermaid
flowchart LR
    subgraph S1 [业务发起]
        direction LR
        A1[天财] --> A2[三代]
    end

    subgraph S2 [业务处理与编排]
        direction LR
        B1[业务核心]
        B2[行业钱包]
        B3[交易系统]
        B1 --> B2
        B3 --> B1
    end

    subgraph S3 [核心账务处理]
        direction LR
        C1[清结算]
        C2[账户系统]
        C3[账务核心]
        C1 --> C2
        C2 --> C3
    end

    subgraph S4 [支撑服务]
        direction LR
        D1[计费中台]
        D2[电子签约平台]
        D3[认证系统]
        D4[代付系统]
        D5[风控]
    end

    subgraph S5 [数据服务]
        E1[对账单系统]
    end

    A2 --> B2
    B2 --> C1
    B2 --> D2
    D2 --> D3
    C1 --> D1
    D4 --> C2
    D4 --> D1
    D5 --> C1
    C1 --> E1
    B2 --> E1
```

## 2.5 系统模块交互关系

模块间主要通过同步API调用与异步事件进行交互，形成清晰的上下游依赖关系。“行业钱包”作为核心协调者，依赖多个底层服务；“清结算”和“账户系统”是资金处理的关键路径；“三代”和“业务核心”是主要的外部请求入口。

```mermaid
graph TD
    A[天财]
    B[三代]
    C[行业钱包]
    D[清结算]
    E[账户系统]
    F[账务核心]
    G[电子签约平台]
    H[计费中台]
    I[对账单系统]
    J[业务核心]
    K[认证系统]
    L[交易系统]
    M[代付系统]
    N[风控]

    A -- “发起业务请求” --> B
    A -- “发起分账请求” --> J
    B -- “调用开户/绑定” --> C
    J -- “调用分账处理” --> C
    L -- “转发交易请求” --> J

    C -- “请求账户操作” --> E
    C -- “请求清分结算” --> D
    C -- “发起签约” --> G
    C -- “计算手续费” --> H
    C -- “请求身份认证” --> K
    C -- “同步分账数据” --> J
    C -- “提供对账数据” --> I

    D -- “扣增账户余额” --> E
    D -- “触发账务记账” --> F
    D -- “计算并扣手续费” --> H
    D -- “提供结算数据” --> I
    D -- “执行冻结指令” --> N

    E -- “驱动账务记录” --> F

    G -- “调用验证接口” --> K

    M -- “扣减付款方账户” --> E
    M -- “计算付款手续费” --> H
    M -- “验证付款方授权” --> G

    N -- “冻结账户/交易” --> D
    N -- “查询账户状态” --> E

    I -- “拉取结算数据” --> D
    I -- “拉取账户数据” --> C
```