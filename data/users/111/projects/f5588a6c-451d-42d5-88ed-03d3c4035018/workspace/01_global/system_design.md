## 2.1 系统结构
系统采用分层架构，核心是业务处理与底层服务分离。上层业务模块（如三代、行业钱包、业务核心）负责处理业务流程、规则校验和状态管理。底层服务模块（如账户系统、账务核心、清结算）提供原子化的资金操作、记账和结算能力。认证、计费等中台服务提供通用能力支撑。模块间通过定义清晰的API进行同步或异步通信，确保职责清晰、松耦合。

```mermaid
flowchart TD
    subgraph "外部系统/用户"
        A[天财/业务方]
        B[收单商户/非收单商户]
        C[银行/验证服务]
    end

    subgraph "业务接入与流程层"
        D[三代]
        E[业务核心]
        F[行业钱包]
        G[电子签约平台]
    end

    subgraph "核心业务处理层"
        H[清结算]
        I[代付系统]
        J[风控]
    end

    subgraph "基础服务层"
        K[账户系统]
        L[账务核心]
        M[计费中台]
        N[认证系统]
    end

    subgraph "数据与支撑层"
        O[对账单系统]
        P[交易系统]
        Q[消息队列]
    end

    subgraph "前端入口"
        R[钱包APP/商服平台]
    end

    A --> D
    B --> R
    R --> D & F & G & H & E & O & K
    D --> F & G
    E --> F & H & J
    F --> H & K & M & J & O
    G --> N
    H --> K & L & O
    I --> K & L & M & G & J
    J --> H & K
    K --> L & Q
    M --> L
    N --> C
    P --> H
```

## 2.2 功能结构
系统功能围绕天财分账业务的核心流程展开，主要包括机构与账户管理、关系绑定与认证、资金分账与结算、风险控制、以及账单服务五大功能域。每个功能域由相应的系统模块协同完成。

```mermaid
flowchart TD
    A[天财分账业务平台]

    A --> B1[机构与账户管理]
    A --> B2[关系绑定与认证]
    A --> B3[资金分账与结算]
    A --> B4[风险控制]
    A --> B5[账单服务]

    B1 --> C1[机构号分配与审核]
    B1 --> C2[账户开户与维护]
    B1 --> C3[接口权限控制]

    B2 --> C4[协议签署流程]
    B2 --> C5[打款/人脸验证]
    B2 --> C6[关系绑定管理]

    B3 --> C7[分账请求处理]
    B3 --> C8[交易清分结算]
    B3 --> C9[批量付款处理]
    B3 --> C10[手续费计算]
    B3 --> C11[账户转账执行]

    B4 --> C12[风险规则判定]
    B4 --> C13[商户/交易冻结]

    B5 --> C14[对账单生成]
    B5 --> C15[交易数据查询]

    C1 --> D[三代]
    C2 --> D
    C3 --> D
    C4 --> E[电子签约平台]
    C5 --> F[认证系统]
    C6 --> G[行业钱包]
    C7 --> H[业务核心]
    C8 --> I[清结算]
    C9 --> J[代付系统]
    C10 --> K[计费中台]
    C11 --> L[账户系统]
    C12 --> M[风控]
    C13 --> M
    C14 --> N[对账单系统]
    C15 --> O[交易系统]
```

## 2.3 网络拓扑图
TBD

## 2.4 数据流转
数据流转以核心业务流程驱动，主要包括开户、关系绑定、分账、结算和冻结流程。数据在模块间按顺序传递，关键状态和结果被记录并同步，确保业务状态的一致性。

```mermaid
flowchart LR
    subgraph "流程: 开户与绑定"
        direction LR
        P1[天财提交申请] --> P2[三代分配机构号]
        P2 --> P3[行业钱包生成用户/账户]
        P3 --> P4[电子签约发起协议]
        P4 --> P5[认证系统执行验证]
        P5 --> P6[行业钱包完成绑定]
    end

    subgraph "流程: 分账与结算"
        direction LR
        Q1[天财发起分账] --> Q2[业务核心接收]
        Q2 --> Q3[行业钱包处理请求]
        Q3 --> Q4[计费中台计算手续费]
        Q4 --> Q5[清结算执行结算]
        Q5 --> Q6[账户系统执行转账]
        Q6 --> Q7[账务核心完成记账]
        Q7 --> Q8[对账单系统生成账单]
    end

    subgraph "流程: 风控冻结"
        direction LR
        R1[风控判定风险] --> R2[生成冻结指令]
        R2 --> R3[清结算/账户系统执行冻结]
        R3 --> R4[更新账户状态]
    end

    P6 --> Q3
    Q8 --> TBD[天财/商户]
    R4 --> TBD
```

## 2.5 系统模块交互关系
模块交互关系基于职责划分，形成服务调用与事件驱动的混合模式。三代作为总入口，协调开户与绑定；业务核心与行业钱包处理主要业务逻辑；底层系统提供原子操作；中台系统提供支撑能力。

```mermaid
flowchart TD
    A[三代]
    B[业务核心]
    C[行业钱包]
    D[清结算]
    E[账户系统]
    F[账务核心]
    G[电子签约平台]
    H[认证系统]
    I[计费中台]
    J[对账单系统]
    K[风控]
    L[代付系统]
    M[交易系统]
    N[钱包APP/商服平台]

    A -- “机构开户/审核” --> C
    A -- “发起关系绑定/开通付款” --> G
    B -- “处理分账请求” --> C
    C -- “请求结算” --> D
    C -- “执行转账/查询账户” --> E
    C -- “校验计费” --> I
    C -- “同步数据” --> J
    C -- “接收冻结指令” --> K
    D -- “执行结算/冻结/扣款” --> E
    D -- “触发记账” --> F
    D -- “提供结算数据” --> J
    E -- “发起记账” --> F
    G -- “调用验证” --> H
    I -- “同步手续费信息” --> F
    K -- “发起账户/交易冻结” --> D & E
    L -- “执行付款转账” --> E
    L -- “计算手续费” --> I
    L -- “签约校验” --> G
    M -- “传递交易数据” --> D
    N -- “前端操作入口” --> A & C & G & D & B & J & E
```