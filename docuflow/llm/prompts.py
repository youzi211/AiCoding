"""
统一管理所有 LLM 提示词模板
"""

# 内容大小限制
MAX_DOCUMENT_SIZE = 50000
MAX_MODULE_SIZE = 20000

# ============================================================
# 术语表提取
# ============================================================

GLOSSARY_PROMPT = """你是一位资深的技术分析师，正在从软件需求文档中提取关键术语。

请分析以下文档内容，提取：
1. 业务实体（例如：用户、订单、账户）
2. 领域特定的技术术语
3. 系统中的角色和参与者
4. 关键流程和工作流

对于每个术语，请提供：
- 术语名称
- 清晰的定义
- 分类（业务实体、角色、流程、技术术语）
- 任何别名或替代名称

文档内容：
{document_content}

请以以下 JSON 格式回复：
{{
  "entries": [
    {{
      "term": "术语名称",
      "definition": "清晰的定义",
      "category": "分类",
      "aliases": ["别名1", "别名2"]
    }}
  ]
}}
"""

# ============================================================
# DAG 生成
# ============================================================

DAG_PROMPT = """你是一位资深的软件架构师，正在分析需求文档以识别系统模块及其依赖关系。

根据以下需求文档和术语表，请识别：
1. 不同的功能模块/子系统
2. 模块之间的依赖关系（哪个模块必须在另一个之前设计）

识别依赖关系的指导原则：
- 如果模块 B 使用模块 A 的数据或接口，则 B 依赖于 A
- 如果模块 B 需要模块 A 正常运行，则 B 依赖于 A
- 避免循环依赖
- 首先识别基础模块（没有依赖的模块）

术语表参考：
{glossary}

需求文档：
{document_content}

请以以下 JSON 格式回复：
{{
  "modules": [
    {{
      "name": "模块名称",
      "description": "简要描述",
      "dependencies": ["依赖1", "依赖2"]
    }}
  ]
}}

重要：确保依赖图是无环的（DAG）。dependencies 中的每个模块名称必须存在于 modules 列表中。
"""

# ============================================================
# 模块设计
# ============================================================

MODULE_DESIGN_PROMPT = """你是一位资深的软件架构师，正在创建详细的设计文档。

请基于以下上下文，设计 "{module_name}" 模块。

=== 上下文 ===
{context}

=== 设计要求 ===
请设计一份全面的模块规格说明，包括：

1. **概述**：本模块的目的和范围
2. **接口设计**：
   - API 端点（REST/GraphQL）
   - 输入/输出数据结构
   - 发布/消费的事件
3. **数据模型**：
   - 数据库表/集合设计
   - 与其他模块的关系
4. **业务逻辑**：
   - 核心算法
   - 业务规则
   - 验证逻辑
5. **时序图**：关键工作流（使用 Mermaid 格式）
6. **错误处理**：预期错误及处理策略
7. **依赖说明**：本模块如何与上游模块交互

请以 Markdown 格式输出设计文档，包含清晰的章节和 Mermaid 图表。
"""

# ============================================================
# 模块摘要提取
# ============================================================

MODULE_SUMMARY_PROMPT = """请从以下模块设计文档中提取关键摘要信息。

模块设计文档：
{module_content}

请以以下 JSON 格式输出摘要：
{{
  "module_name": "模块名称",
  "purpose": "模块职责（一句话描述）",
  "interfaces": [
    {{"method": "GET/POST", "path": "/api/xxx", "description": "接口说明"}}
  ],
  "database_tables": [
    {{"name": "表名", "description": "表说明"}}
  ],
  "dependencies": ["依赖的模块名"],
  "key_features": ["核心功能点1", "核心功能点2"]
}}

注意：只提取关键信息，保持简洁。
"""

# ============================================================
# 系统设计
# ============================================================

SYSTEM_DESIGN_PROMPT = """你是一位资深的软件架构师，请基于以下所有模块的摘要信息，生成系统级设计文档。

=== 模块摘要列表 ===
{module_summaries}

=== 要求 ===
请生成以下内容（使用 Markdown 格式，图表使用 Mermaid）：

## 2.1 系统结构
描述整体系统架构，包含系统架构图（使用 Mermaid C4 或 flowchart）。

## 2.2 功能结构
描述系统的功能模块划分，包含功能结构图。

## 2.3 网络拓扑图
描述系统部署的网络拓扑结构（如适用）。

## 2.4 数据流转
描述系统中数据如何在各模块间流转，包含数据流图。

## 2.5 系统模块交互关系
描述各模块之间的调用和依赖关系，包含模块交互图。

请确保：
1. 图表使用 Mermaid 格式
2. 内容基于实际的模块摘要信息
3. 描述清晰、专业
"""

# ============================================================
# 接口汇总
# ============================================================

INTERFACE_PROMPT = """请基于以下所有模块的摘要信息，生成统一的接口设计章节。

=== 模块摘要列表 ===
{module_summaries}

=== 要求 ===
请生成以下内容（使用 Markdown 格式）：

## 4.1 对外接口
列出系统对外暴露的所有 API 接口，按功能分类。

## 4.2 模块间接口
列出模块之间的内部调用接口。

对于每个接口，请说明：
- 接口路径和方法
- 所属模块
- 功能说明
- 请求/响应格式（如已知）
"""

# ============================================================
# 数据库汇总
# ============================================================

DATABASE_PROMPT = """请基于以下所有模块的摘要信息，生成统一的数据库设计章节。

=== 模块摘要列表 ===
{module_summaries}

=== 要求 ===
请生成以下内容（使用 Markdown 格式，图表使用 Mermaid）：

## 5.1 ER图
使用 Mermaid erDiagram 格式绘制实体关系图。

## 5.2 表结构
列出所有数据库表，包含：
- 表名
- 所属模块
- 主要字段说明
- 与其他表的关系
"""
